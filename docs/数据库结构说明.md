# Motify 数据库表结构说明

### 1. 管理员表 (admins)
**用途**: 存储系统管理员的基本信息和登录凭据
**关键字段**:
- `admin_id`: 管理员ID，主键，自增
- `username`: 登录用户名，带唯一索引
- `password`: 已加密存储的密码
- `is_active`: 账户激活状态
- `last_login_time`: 追踪管理员活跃度

### 2. 汽车表 (cars)
**用途**: 存储用户车辆信息，支持一个用户拥有多辆车
**关键字段**:
- `car_id`: 汽车ID，主键
- `license_plate`: 车牌号，唯一约束
- `user_id`: 外键关联车主
**索引优化**: 车牌号唯一索引，用户ID普通索引

### 3. 维修项目-维修人员关联表 (item_repairman)
**用途**: 多对多关系表，记录维修项目分配给哪些维修人员
**关键字段**:
- `is_accepted`: 维修人员是否接受此工单或拒绝工单
**业务逻辑**: 支持工单分配和接受状态管理

### 4. 维修项目表 (maintenance_items)
**用途**: 存储汽车维修工单的完整生命周期信息
**关键字段**:
- `status`: 维修状态（PENDING/ACCEPTED/CANCELLED/IN_PROGRESS/COMPLETED/AwaitingAssign）
- `cost`: 维修总费用（由触发器自动计算）
- `labor_cost`: 工时费用
- `material_cost`: 材料费用
- `progress`: 维修进度百分比
- `score`: 用户评分

### 5. 维修记录表 (maintenance_records)
**用途**: 记录每个维修人员在每个工单上的具体工作内容和时长
**关键字段**:
- `work_hours`: 工作时长，用于计算工时费
- `repair_man_id`: 执行维修的人员ID
**计费逻辑**: 工作时长 × 维修人员时薪 = 工时费

### 6. 材料表 (materials)
**用途**: 存储维修用材料和配件的基本信息，支持库存管理
**关键字段**:
- `type`: 材料类型（BATTERY/BODY/BRAKE/ELECTRICAL/FILTER/OIL/OTHER/TIRE）
- `price`: 材料单价
- `stock`: 库存数量

### 7. 维修记录-材料关联表 (record_material)
**用途**: 记录每次维修工作中使用的材料及其数量
**计费逻辑**: 材料单价 × 使用数量 = 材料费

### 8. 维修人员表 (repairmen)
**用途**: 存储维修人员的基本信息和技能类型
**关键字段**:
- `type`: 维修人员类型（APPRENTICE/BODYWORKER/DIAGNOSER/ELECTRICIAN/INSPECTOR/MECHANIC/PAINTER）
- `username`: 登录用户名，唯一约束

### 9. 维修人员历史记录表 (repairman_history)
**用途**: 记录维修人员信息的变更历史，用于审计和追踪
**关键字段**:
- `id`: 历史记录ID，主键，自增
- `repairman_id`: 关联的维修人员ID，记录变更对象
- `operation`: 操作类型（CREATE/UPDATE/DELETE）
- `operation_time`: 操作时间，记录变更发生的时间点
- `operator`: 操作人员，记录是谁进行的变更
- `email`、`name`、`password`、`phone`、`type`、`username`: 变更前的字段值
**业务逻辑**: 为数据治理和合规审计提供完整的变更轨迹

### 10. 所需维修人员类型表 (required_repairman_types)
**用途**: 定义每个维修项目需要哪些类型的维修人员及数量，支持智能工单分配
**关键字段**:
- `id`: 记录ID，主键，自增
- `item_id`: 关联的维修项目ID，外键关联maintenance_items表
- `type`: 需要的维修人员类型（APPRENTICE/BODYWORKER/DIAGNOSER/ELECTRICIAN/INSPECTOR/MECHANIC/PAINTER）
- `required`: 需要的人数，该维修项目要求的特定类型人员数量
- `assigned`: 已分配的人数，实际分配给该维修项目的特定类型人员数量
**业务逻辑**: 
- 支持按技能类型进行人员分配管理
- 当所有工种的已分配人数达到需求时，触发器自动将工单状态更新为IN_PROGRESS
- 实现工单自动化状态管理

### 11. 薪资标准表 (salaries)
**用途**: 定义不同类型维修人员的时薪标准，用于自动计算工时费用
**关键字段**:
- `type`: 维修人员类型，主键（APPRENTICE/BODYWORKER/DIAGNOSER/ELECTRICIAN/INSPECTOR/MECHANIC/PAINTER）
- `hourly_rate`: 时薪标准，单位：元/小时
**业务逻辑**: 
- 与repairmen表建立外键关系，确保每种类型都有对应薪资标准
- 触发器自动计算工时费：维修记录的工作时长 × 对应工种时薪
- 支持薪资标准的统一管理和调整

### 12. 用户历史记录表 (user_history)
**用途**: 记录用户信息的变更历史，确保数据变更的可追溯性
**关键字段**:
- `id`: 历史记录ID，主键，自增
- `user_id`: 关联的用户ID，记录变更对象
- `operation`: 操作类型（CREATE/UPDATE/DELETE）
- `operation_time`: 操作时间，记录变更发生的时间点
- `operator`: 操作人员，记录是谁进行的变更
- `address`、`email`、`name`、`phone`、`username`: 变更前的字段值
**业务逻辑**: 为用户数据管理提供完整的审计日志，支持数据恢复和合规检查

### 13. 用户表 (users)
**用途**: 存储系统用户（车主）的基本信息和登录凭据
**关键字段**:
- `user_id`: 用户ID，主键，自增
- `username`: 登录用户名，带唯一索引，必须唯一
- `password`: 登录密码，已加密存储
- `name`: 用户真实姓名，车主姓名
- `email`: 用户邮箱地址，用于通知和联系
- `phone`: 用户联系电话，紧急联系时使用
- `address`: 用户地址，用于车辆送修时的联系
**关系说明**: 与cars表建立一对多关系，一个用户可以拥有多辆车

### 14. 工资结算表 (wages)
**用途**: 记录维修人员的月度工资结算明细，支持工资统计和历史查询
**关键字段**:
- `id`: 工资记录ID，主键，自增
- `repairman_id`: 维修人员ID，外键关联repairmen表
- `year`: 结算年份
- `month`: 结算月份（1-12月）
- `settlement_date`: 结算日期，记录工资计算和发放的时间
- `total_work_hours`: 总工作时长，本月累计工作小时数
- `hourly_rate`: 时薪标准，记录结算时的时薪（冗余存储避免历史数据受薪资调整影响）
- `total_income`: 总收入，本月应发工资总额
- `repairman_name`: 维修人员姓名（冗余存储）
- `repairman_type`: 维修人员类型（冗余存储）
**业务逻辑**: 
- 支持按年月维度的工资统计和查询
- 冗余存储关键信息，确保历史工资记录不受人员信息变更影响
- 为财务报表和薪资分析提供数据基础

## 索引优化说明

### 唯一索引 (UNIQUE)
- `uk_admin_username`: 管理员用户名唯一性
- `uk_car_license_plate`: 车牌号唯一性
- `uk_repairman_username`: 维修人员用户名唯一性
- `uk_user_username`: 用户用户名唯一性

### 普通索引 (INDEX)
- `idx_car_user_id`: 优化根据用户查询车辆
- `idx_maintenance_item_car_id`: 优化根据汽车查询维修记录
- `idx_maintenance_record_item_id`: 优化根据维修项目查询记录
- `idx_repairman_type`: 优化根据维修人员类型查询
- `idx_wage_repairman_id`: 优化根据维修人员查询工资



